from urllib.request import urlopen
from urllib.parse import urlencode
from contextlib import closing
try:
   from PIL import Image
except:
   print("If you are on a Windows machine, please install PIL (imaging library) using 'python -m pip install Pillow' in the Anaconda Prompt")
   exit()
import json


# json object for the query
query = {q}


# Assemble full request
base_url = "http://navigator.oceansdata.ca/plot/?"
url = base_url + urlencode({{"query": json.dumps(query)}})
print(url)


#Open URL and save response
with closing(urlopen(url)) as f:
  img = Image.open(f)
  img.save("script_template_" + str(query["dataset"]) + "_" + str(query["{var}"]) + ".png" , "PNG")
