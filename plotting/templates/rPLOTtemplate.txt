library(jsonlite)


query <- '{q}'

dpi <- 144
queryObj <- fromJSON(query)
fname <- paste("ONAV_PLOT_", queryObj["dataset"],"_", queryObj["variable"],".png", sep="")

gsub("[\r\n]", "", query)
base_url <- "http://navigator.oceansdata.ca/api/v1.0/plot/?"
url <- paste(base_url,"&query=",URLencode(query),"&dpi=",toString(dpi), sep="")
print(url)


print("Downloading file and exiting...")
download.file(url, fname, method="auto", mode = 'wb')